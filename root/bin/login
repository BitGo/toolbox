#!/bin/bash
gpg --import /etc/keys/*.pub >/dev/null 2>&1

export LOGIN_FINGERPRINT="$1"

login="$( \
	gpg --list-keys --with-colons "$LOGIN_FINGERPRINT" 2> /dev/null \
	| grep -E '^uid:.*' \
	| head -n1 \
	| sed 's/.*<\(.*\)\@.*>.*/\1/' \
)";
export LOGIN_NAME="${login:-$LOGIN_FINGERPRINT}"

# If connected via ssh and not in tmux, attach
[[ -z "$TMUX" ]] && [ "$SSH_CONNECTION" != "" ] && \
	tmux new-session -A -t admin -s "$LOGIN_NAME" && exit
